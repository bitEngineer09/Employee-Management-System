generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

// enums data
enum AttendanceStatus {
  PRESENT
  ABSENT
  HALF_DAY
  LEAVE_PAID
  LEAVE_UNPAID
}

enum AttendanceAction {
  AUTO_ABSENT
  CHECK_IN
  CHECK_OUT
  UPDATE
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum LeaveType {
  CASUAL
  SICK
  PAID
  UNPAID
}

// models
model user {
  id             Int             @id @default(autoincrement())
  name           String
  email          String          @unique(map: "User_email_key")
  password       String
  role           String          @default("EMPLOYEE")
  employeeId     String?         @unique
  department     String?
  designation    String?
  isActive       Boolean         @default(true)
  monthlySalary  Float?
  basicSalary    Float?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  session        session[]
  attendances    Attendance[]
  attendanceLogs AttendanceLog[] @relation("changedBy")
  leaves         Leave[]
  leaveBalance   LeaveBalance[]
  payroll        Payroll[]
}

model session {
  id        Int      @id @default(autoincrement())
  valid     Boolean  @default(true)
  ip        String
  userAgent String
  userId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Session_userId_fkey")

  @@index([userId], map: "Session_userId_idx")
}

model Attendance {
  id         Int      @id @default(autoincrement())
  employeeId Int
  date       DateTime @db.Date

  checkIn      DateTime?
  checkOut     DateTime?
  workingHours Float?
  status       AttendanceStatus

  employee       user            @relation(fields: [employeeId], references: [id])
  attendanceLogs AttendanceLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([employeeId, date]) // Ek employee ki ek hi din me ek attendance
}

model AttendanceLog {
  id           Int @id @default(autoincrement())
  attendanceId Int

  action    AttendanceAction
  oldStatus AttendanceStatus?
  newStatus AttendanceStatus?

  changedBy     Int?
  changedByUser user? @relation("changedBy", fields: [changedBy], references: [id])

  attendance Attendance @relation(fields: [attendanceId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([attendanceId])
}

model Holiday {
  id        Int      @id @default(autoincrement())
  name      String
  date      DateTime @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Leave {
  id         Int         @id @default(autoincrement())
  employeeId Int
  fromDate   DateTime    @db.Date
  toDate     DateTime    @db.Date
  type       LeaveType
  reason     String?
  status     LeaveStatus @default(PENDING)
  approvedBy Int?
  employee   user        @relation(fields: [employeeId], references: [id])
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
}

model LeaveBalance {
  id         Int  @id @default(autoincrement())
  employeeId Int
  year       Int
  casualLeft Int  @default(12)
  employee   user @relation(fields: [employeeId], references: [id])

  @@unique([employeeId, year])
}

model Payroll {
  id               Int      @id @default(autoincrement())
  employeeId       Int
  month            String
  grossSalary      Float
  pf               Float
  tax              Float
  netSalary        Float
  totalWorkingDays Int
  payableDays      Int
  employee         user     @relation(fields: [employeeId], references: [id])
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@unique([employeeId, month])
}

model PasswordResetOtp {
  id        Int      @id @default(autoincrement())
  email     String
  otp       String
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([email])
}
